(self.webpackChunkbdmdm=self.webpackChunkbdmdm||[]).push([[833],{3231:(e,o,i)=>{"use strict";i.r(o),i.d(o,{default:()=>p});var n=i(5043),l=i(5989),t=i(5487),a=i(3216),r=i(2297),s=i(6351),c=i(9596),d=i(579);const u=e=>{let{selectedFile:o}=e;const[i,l]=(0,n.useState)({hallazgos:"",impresion:"",observaciones:"",medico:"",medicoNuevo:localStorage.getItem("nombre"),fecha:"",tipoEstudio:"",region:"",proyeccion:"",valido:"",obtencion:"",sexo:"",edad:""}),t={"02":[{value:"03",label:"Cervical"},{value:"04",label:"Tor\xe1cica"},{value:"05",label:"Lumbar"},{value:"06",label:"Sacra"},{value:"07",label:"Coxis"}],26:[{value:"18",label:"Pelvis Adulto"},{value:"19",label:"Pelvis Infantil"}]},[a,r]=(0,n.useState)(""),[s,u]=(0,n.useState)(""),[p,h]=(0,n.useState)("");(0,n.useEffect)((()=>{o&&(g(),(async()=>{try{g();const e=o.split("/").pop().replace(/\.jpg$/,".dcm"),i=await fetch(`${c.C}/estudios/dicom?nombre=${e}`);if(!i.ok)throw new Error("Error al obtener el estudio");const n=await i.json();if(!n||!n.estudio_id)throw new Error("Estudio no encontrado");const t=await fetch(`${c.C}/estudios/diagnostico?id=${n.estudio_id}&nombreImagen=${e}`);if(!t.ok)throw new Error("Error al obtener el diagn\xf3stico");const a=await t.json(),s=a.diagnostico||{},d=a.clave||"";r(d);const u=m(d);l((e=>({...e,...u,hallazgos:s.Hallazgos||"",impresion:s.Impresion||"",observaciones:s.Observaciones||"",medico:s.Medico||"",fecha:s.Fecha&&"0001-01-01"!==s.Fecha?s.Fecha.split("T")[0]:""})))}catch(e){h("Error al obtener el diagn\xf3stico m\xe1s reciente.")}})())}),[o]);const x=e=>{const{name:o,value:i}=e.target;l((e=>({...e,[o]:i,..."region"===o&&{subregion:""}})))},g=()=>{l({hallazgos:"",impresion:"",observaciones:"",medico:"",medicoNuevo:localStorage.getItem("nombre"),fecha:"",tipoEstudio:"",region:"",proyeccion:"",valido:"",obtencion:"",sexo:"",edad:""})},m=e=>{var o,i;if(!e||e.length<11)return{};const n=e.substring(2,4)||"",l=(null===(o=t[n])||void 0===o||null===(i=o[0])||void 0===i?void 0:i.value)||"";return{tipoEstudio:e.substring(0,2)||"",region:n,subregion:l,proyeccion:e.substring(4,6)||"",valido:e.substring(6,7)||"",obtencion:e.substring(8,9)||"",sexo:e.substring(9,10)||"",edad:e.substring(10,11)||""}};return(0,d.jsxs)("div",{className:"form-diagnostico",style:{margin:"20px"},children:[(0,d.jsx)("h2",{children:"Diagn\xf3stico"}),(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=o.split("/").pop().replace(/\.jpg$/,".dcm"),n=new Date(i.fecha).toISOString(),t=await fetch(`${c.C}/estudios/dicom?nombre=${e}`);if(!t.ok)throw new Error("Error al obtener el estudio");const a=await t.json();if(!a||!a.estudio_id)throw new Error("Estudio no encontrado");null==i.subregion&&""==i.subregion||(i.region=i.subregion);const r=i.tipoEstudio+i.region+i.proyeccion+i.valido+"1"+i.obtencion+i.sexo+i.edad,s={hallazgos:i.hallazgos,impresion:i.impresion,observaciones:i.observaciones,medico:i.medico,medicoNuevo:localStorage.getItem("nombre"),fecha:n,tipoEstudio:i.tipoEstudio,region:i.region,proyeccion:i.proyeccion,valido:i.valido,obtencion:i.obtencion,sexo:i.sexo,edad:i.edad};if(!(await fetch(`${c.C}/diagnosticos/${a.estudio_id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({imagenNombre:e,clave:r,diagnostico:s})})).ok)throw new Error("Error al actualizar el diagn\xf3stico");alert("Diagn\xf3stico guardado exitosamente"),h(""),l({hallazgos:"",impresion:"",observaciones:"",medico:"",medicoNuevo:"",fecha:"",tipoEstudio:"",region:"",proyeccion:"",valido:"",obtencion:"",sexo:"",edad:""})}catch(n){h("Error al actualizar el diagn\xf3stico.")}},children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Regi\xf3n:"}),(0,d.jsxs)("select",{name:"region",value:i.region,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"00",children:"Desconocido"}),(0,d.jsx)("option",{value:"02",children:"Columna Vertebral"}),(0,d.jsx)("option",{value:"26",children:"Pelvis"})]})]}),i.region&&t[i.region]&&(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Subregi\xf3n:"}),(0,d.jsxs)("select",{name:"subregion",value:i.subregion,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),t[i.region].map((e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Proyecci\xf3n:"}),(0,d.jsxs)("select",{name:"proyeccion",value:i.proyeccion,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"00",children:"Desconocido"}),(0,d.jsx)("option",{value:"01",children:"Postero Anterior"}),(0,d.jsx)("option",{value:"02",children:"Antero Posterior"}),(0,d.jsx)("option",{value:"03",children:"Obliqua"}),(0,d.jsx)("option",{value:"04",children:"Lateral Izquierda"}),(0,d.jsx)("option",{value:"05",children:"Lateral Derecha"}),(0,d.jsx)("option",{value:"06",children:"Especial"}),(0,d.jsx)("option",{value:"07",children:"Comparativa"})]})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"hallazgos",children:"Hallazgos:"}),(0,d.jsx)("textarea",{id:"hallazgos",name:"hallazgos",placeholder:"Ingresa los hallazgos",value:i.hallazgos,onChange:x,required:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px",height:"100px",resize:"vertical"}})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"impresion",children:"Impresi\xf3n Diagn\xf3stica:"}),(0,d.jsx)("textarea",{id:"impresion",name:"impresion",placeholder:"Ingresa la impresi\xf3n diagn\xf3stica",value:i.impresion,onChange:x,required:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px",height:"100px",resize:"vertical"}})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"observaciones",children:"Observaciones:"}),(0,d.jsx)("textarea",{id:"observaciones",name:"observaciones",placeholder:"Ingresa las observaciones",value:i.observaciones,onChange:x,required:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px",height:"100px",resize:"vertical"}})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Sexo:"}),(0,d.jsxs)("select",{name:"sexo",value:i.sexo,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"0",children:"Desconocido"}),(0,d.jsx)("option",{value:"1",children:"Masculino"}),(0,d.jsx)("option",{value:"2",children:"Femenino"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Edad:"}),(0,d.jsxs)("select",{name:"edad",value:i.edad,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"0",children:"Desconocido"}),(0,d.jsx)("option",{value:"1",children:"Lactante menores de 1 a\xf1o"}),(0,d.jsx)("option",{value:"2",children:"Prescolar 1-5"}),(0,d.jsx)("option",{value:"3",children:"Infante 6-12"}),(0,d.jsx)("option",{value:"4",children:"Adolescente 13-18"}),(0,d.jsx)("option",{value:"5",children:"Adulto joven 19-26"}),(0,d.jsx)("option",{value:"6",children:"Adulto 27-59"}),(0,d.jsx)("option",{value:"7",children:"Adulto mayor 60+"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"V\xe1lido:"}),(0,d.jsxs)("select",{name:"valido",value:i.valido,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"0",children:"Desconocido"}),(0,d.jsx)("option",{value:"1",children:"S\xed"}),(0,d.jsx)("option",{value:"2",children:"No"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},children:"Obtencion:"}),(0,d.jsxs)("select",{name:"obtencion",value:i.Obtencion,onChange:x,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccione"}),(0,d.jsx)("option",{value:"2",children:"Desconocido"}),(0,d.jsx)("option",{value:"1",children:"Estudio digital"}),(0,d.jsx)("option",{value:"2",children:"Estudio Fisico"})]})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"fecha",children:"Fecha del diagn\xf3stico:"}),(0,d.jsx)("input",{type:"date",id:"fecha",name:"fecha",value:i.fecha,onChange:x,readOnly:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px"}})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"medicoA",children:"M\xe9dico que hizo el diagn\xf3stico:"}),(0,d.jsx)("input",{type:"text",id:"medicoA",name:"medicoA",placeholder:"Ingresa el nombre del m\xe9dico",value:i.medico,onChange:x,readOnly:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px"}})]}),(0,d.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,d.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"medico",children:"Tu nombre:"}),(0,d.jsx)("input",{type:"text",id:"medico",name:"medico",placeholder:"Ingresa el nombre del m\xe9dico",value:i.medicoNuevo,onChange:x,readOnly:!0,style:{width:"100%",padding:"10px",marginTop:"5px",border:"1px solid #ccc",borderRadius:"5px"}})]}),(0,d.jsx)("button",{type:"submit",style:{backgroundColor:"#28a745",color:"white",padding:"10px 20px",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Guardar diagnostico"})]}),s&&(0,d.jsx)("p",{children:s})]})};i(1047);const p=function(){const[e,o]=(0,n.useState)(null),[i,c]=(0,n.useState)(null);return(0,a.Zp)(),(0,d.jsxs)("div",{className:"visualizer-page",children:[(0,d.jsx)(r.A,{}),(0,d.jsx)("div",{className:"next-module"}),(0,d.jsxs)("div",{className:"content",children:[(0,d.jsx)("div",{className:"thumbnail-gallery",children:(0,d.jsx)(l.A,{onThumbnailClick:e=>{const i=e.split("/").pop().replace(".jpg",".dcm");o(i),c(e)}})}),(0,d.jsx)("div",{className:"dicom-viewer",children:e?(0,d.jsx)(t.A,{fileName:e}):(0,d.jsx)("p",{children:"Selecciona una miniatura para ver la imagen DICOM."})}),(0,d.jsx)("div",{className:"study-info",children:i?(0,d.jsx)(u,{selectedFile:i}):(0,d.jsx)("p",{children:"Selecciona una miniatura para emitir un diagnostico."})})]}),(0,d.jsx)("div",{className:"next-module"}),(0,d.jsx)(s.A,{})]})}},5989:(e,o,i)=>{"use strict";i.d(o,{A:()=>u});var n=i(5043),l=i(9596),t=(i(1047),i(579));const a={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"20px",justifyContent:"center",padding:"20px",border:"1px solid #ddd",width:"100%",boxSizing:"border-box"},r={width:"100%",height:"auto",objectFit:"cover"},s={cursor:"pointer",overflow:"hidden",position:"relative",borderRadius:"5px",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.2)",transition:"transform 0.2s"},c={marginBottom:"10px",display:"flex",justifyContent:"center"},d={display:"block",margin:"20px auto",padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#38b2ac",color:"#ffffff",border:"none",borderRadius:"5px",transition:"background-color 0.3s"},u=e=>{let{onThumbnailClick:o}=e;const[i,u]=(0,n.useState)([]),[p,h]=(0,n.useState)(!1),[x,g]=(0,n.useState)(null),[m,v]=(0,n.useState)(1),[b,j]=(0,n.useState)(!0),[f,y]=(0,n.useState)(""),[C,w]=(0,n.useState)(""),[S,E]=(0,n.useState)(""),T={"02":[{value:"03",label:"Cervical"},{value:"04",label:"Tor\xe1cica"},{value:"05",label:"Lumbar"},{value:"06",label:"Sacra"},{value:"07",label:"Coxis"}],26:[{value:"18",label:"Pelvis Adulto"},{value:"19",label:"Pelvis Infantil"}]},N=(0,n.useCallback)((async e=>{if(!f)return;const o=S||C;try{const i=new URLSearchParams({tipoEstudio:f,...o&&{region:o},page:e,limit:9}).toString(),n=await fetch(`${l.C}/thumbnails?${i}`);if(n.ok){const{images:o,total:i}=await n.json();u(1===e?o:e=>[...e,...o]),j(!(9*e>=i)),h(!0)}else g("Error al obtener las im\xe1genes")}catch(x){g("Error en la solicitud de im\xe1genes: "+x.message)}}),[C,S,f]);(0,n.useEffect)((()=>{u([]),v(1),j(!0),h(!1),N(1)}),[N,f,C,S]);return x?(0,t.jsx)("p",{children:x}):(0,t.jsxs)("div",{className:"thumbnail-gallery-container",style:{marginLeft:"100px",maxWidth:"1200px",margin:"0 auto"},children:[(0,t.jsx)("h1",{className:"text-5xl font-extrabold mb-4 animate-reveal",style:{color:"#666666",marginTop:"20px",fontWeight:"900",fontFamily:"Poppins",textAlign:"center"},children:"Estudios m\xe9dicos"}),(0,t.jsxs)("div",{className:"filters",style:c,children:[(0,t.jsxs)("label",{children:["Tipo de Estudio:",(0,t.jsxs)("select",{value:f,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccione"}),(0,t.jsx)("option",{value:"01",children:"Radiograf\xeda"}),(0,t.jsx)("option",{value:"02",children:"Tomograf\xeda Computarizada"}),(0,t.jsx)("option",{value:"03",children:"Resonancia Magn\xe9tica"}),(0,t.jsx)("option",{value:"04",children:"Ultrasonido"}),(0,t.jsx)("option",{value:"05",children:"Mamograf\xeda"}),(0,t.jsx)("option",{value:"06",children:"Angiograf\xeda"}),(0,t.jsx)("option",{value:"07",children:"Medicina Nuclear"}),(0,t.jsx)("option",{value:"08",children:"Medio de contraste"}),(0,t.jsx)("option",{value:"09",children:"Fluoroscopia"})]})]}),(0,t.jsxs)("label",{children:["Regi\xf3n:",(0,t.jsxs)("select",{value:C,onChange:e=>{w(e.target.value),E("")},children:[(0,t.jsx)("option",{value:"",children:"Seleccione"}),(0,t.jsx)("option",{value:"00",children:"Desconocido"}),(0,t.jsx)("option",{value:"02",children:"Columna Vertebral"}),(0,t.jsx)("option",{value:"26",children:"Pelvis"})]})]}),C&&T[C]&&(0,t.jsxs)("label",{children:["Subregi\xf3n:",(0,t.jsxs)("select",{value:S,onChange:e=>{E(e.target.value)},children:[(0,t.jsx)("option",{value:"",children:"Seleccione"}),T[C].map((e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value)))]})]})]}),(0,t.jsxs)("div",{className:"thumbnail-gallery",style:{marginTop:"20px"},children:[p?i.length>0?(0,t.jsx)("div",{style:a,children:i.map(((e,i)=>(0,t.jsx)("div",{style:s,onClick:()=>o(e),onContextMenu:e=>e.preventDefault(),children:(0,t.jsx)("img",{src:e,alt:`Thumbnail ${i}`,style:r,onError:e=>{e.currentTarget.src="https://via.placeholder.com/150"}})},i)))}):(0,t.jsx)("p",{children:"No hay im\xe1genes disponibles."}):(0,t.jsx)("p",{children:"Seleccione el tipo de estudio..."}),b&&(0,t.jsx)("button",{onClick:()=>{if(b){const e=m+1;v(e),N(e)}},style:d,children:"Cargar m\xe1s"})]})]})}},5487:(e,o,i)=>{"use strict";i.d(o,{A:()=>x});var n=i(5043),l=i(1825),t=i.n(l),a=i(5060),r=i.n(a),s=i(9492),c=i.n(s),d=i(5872),u=i.n(d),p=i(9596),h=i(579);u().external.cornerstone=t(),u().external.dicomParser=c();const x=e=>{let{fileName:o}=e;const[i,l]=(0,n.useState)(!1),[s,c]=(0,n.useState)(null),d=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=d.current;if(e&&o){const i=`wadouri:${p.C}/image/${o}`;return(async()=>{l(!0),c(null);try{t().enable(e),r().addTool(a.ZoomTool),r().addTool(a.PanTool),r().addTool(a.LengthTool),r().addTool(a.RotateTool),r().setToolActive("Zoom",{mouseButtonMask:1}),r().setToolActive("Pan",{mouseButtonMask:1}),r().setToolActive("Length",{mouseButtonMask:1}),r().setToolActive("Rotate",{mouseButtonMask:1});const o=await t().loadImage(i);t().displayImage(e,o),r().setToolActive("Zoom",{mouseButtonMask:1})}catch(s){c("Error al cargar la imagen DICOM.")}finally{l(!1)}})(),()=>{e&&t().disable(e)}}}),[o]);return(0,h.jsxs)("div",{className:"dicom-viewer-container",children:[(0,h.jsxs)("div",{onContextMenu:e=>e.preventDefault(),ref:d,className:"dicom-viewer",style:{width:"100%",height:"100%"},children:[i&&(0,h.jsx)("p",{children:"Cargando imagen DICOM..."}),s&&(0,h.jsx)("p",{style:{color:"red"},children:s})]}),(0,h.jsxs)("div",{className:"tool-buttons",style:{marginTop:"10px",display:"flex",justifyContent:"center",gap:"10px"},children:[(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.scale*=1.2,t().setViewport(d.current,e)},children:"Zoom +"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.scale/=1.2,t().setViewport(d.current,e)},children:"Zoom -"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.translation.y+=20,t().setViewport(d.current,e)},children:"Mover \u2191"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.rotation-=.75,t().setViewport(d.current,e)},children:"Rotar \u2190"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.rotation+=.75,t().setViewport(d.current,e)},children:"Rotar \u2192"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.translation.x+=20,t().setViewport(d.current,e)},children:"Mover \u2190"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.translation.y-=20,t().setViewport(d.current,e)},children:"Mover \u2193"}),(0,h.jsx)("button",{onClick:()=>{const e=t().getViewport(d.current);e.translation.x-=10,t().setViewport(d.current,e)},children:"Mover \u2192"})]})]})}},6559:()=>{}}]);
//# sourceMappingURL=833.4f2452a7.chunk.js.map