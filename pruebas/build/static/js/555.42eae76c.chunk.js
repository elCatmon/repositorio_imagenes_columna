(self.webpackChunkbdmdm=self.webpackChunkbdmdm||[]).push([[555],{61:(e,a,o)=>{"use strict";o.r(a),o.d(a,{default:()=>h});var i=o(5043),s=o(6159),n=o.n(s),t=o(9596),r=o(9492),d=o(2297),l=o(6351),c=o(579);const h=()=>{const[e,a]=(0,i.useState)([]),[o,s]=(0,i.useState)(""),[h,p]=(0,i.useState)(null),[u,x]=(0,i.useState)(!1),[m,f]=(0,i.useState)("");(0,i.useEffect)((()=>{let e,a;return u&&(e=setTimeout((()=>{f("Esto est\xe1 tardando m\xe1s de lo esperado, por favor espere..."),a=setTimeout((()=>{f("El tiempo de subida y procesamiento depende de la cantidad de archivos, por favor espera...")}),2e4)}),1e4)),()=>{clearTimeout(e),clearTimeout(a)}}),[u]);const j=async e=>{const i=new(n()),s=await i.loadAsync(e),t=[];for(const a in s.files)if(a.endsWith(".dicom")||a.endsWith(".dcm")){const e=await i.file(a).async("arraybuffer"),s=new File([e],a),n=await g(s);t.push({file:s,tipoEstudio:o||"No seleccionado",metadata:n})}return t.length>0&&(a((e=>[...e,...t])),!0)},g=async e=>{try{const a=await e.arrayBuffer(),o=new Uint8Array(a),i=r.parseDicom(o),s=i.string("x00101010"),n=s?parseInt(s):"No disponible",t=i.string("x00100040"),d=i.string("x00181020"),l=i.string("x00080022");return{age:n,sex:t,region:d,date:l?v(l):"No disponible"}}catch(a){return console.error("Error al extraer metadatos:",a),{age:"No disponible",sex:"No disponible",region:"No disponible",date:"No disponible"}}},v=e=>8===e.length?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:"Formato de fecha inv\xe1lido";return(0,c.jsxs)("div",{children:[(0,c.jsx)(d.A,{}),(0,c.jsxs)("header",{className:"header-section text-center py-12 mt-8",style:{backgroundColor:"transparent !important",paddingTop:"10px"},children:[(0,c.jsx)("h1",{className:"text-5xl font-extrabold mb-4 animate-reveal",style:{color:"#666666",backgroundColor:"transparent !important",marginTop:"20px",fontWeight:"900",fontFamily:"Poppins"},children:"Donaci\xf3n de archivos"}),(0,c.jsx)("p",{className:"text-xl text-gray-700",style:{backgroundColor:"transparent !important",marginTop:"20px",fontSize:"20px",fontFamily:"Poppins"},children:"Elige el tipo de estudio y los archivos correspondientes para realizar tu donaci\xf3n"})]}),(0,c.jsxs)("div",{className:"donaciones-left",onContextMenu:e=>e.preventDefault(),children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"tipo-estudio",children:"Tipo de Estudio:"}),(0,c.jsxs)("select",{id:"tipo-estudio",value:o,onChange:e=>{s(e.target.value)},children:[(0,c.jsx)("option",{value:"00",children:"Seleccione"}),(0,c.jsx)("option",{value:"01",children:"Radiograf\xeda"}),(0,c.jsx)("option",{value:"02",children:"Tomograf\xeda Computarizada"}),(0,c.jsx)("option",{value:"03",children:"Resonancia Magn\xe9tica"}),(0,c.jsx)("option",{value:"04",children:"Ultrasonido"}),(0,c.jsx)("option",{value:"05",children:"Mamograf\xeda"}),(0,c.jsx)("option",{value:"06",children:"Angiograf\xeda"}),(0,c.jsx)("option",{value:"07",children:"Medicina Nuclear"}),(0,c.jsx)("option",{value:"08",children:"Radio Terapia"}),(0,c.jsx)("option",{value:"09",children:"Fluoroscopia"})]})]}),(0,c.jsx)("br",{}),(0,c.jsx)("input",{type:"file",accept:".dcm, .dicom, .zip",multiple:!0,onChange:async e=>{const i=Array.from(e.target.files),s=[];for(const a of i)if(a.size>1073741824)p(`El archivo ${a.name} excede el l\xedmite de 50 MB.`);else if(a.name.endsWith(".zip")){await j(a)||p(`El archivo ZIP ${a.name} no contiene im\xe1genes DICOM v\xe1lidas.`)}else if(a.name.endsWith(".dicom")||a.name.endsWith(".dcm")){const e=await g(a);s.push({file:a,tipoEstudio:o||"No seleccionado",metadata:e})}else p(`El archivo ${a.name} no es un DICOM, DCM o ZIP v\xe1lido.`);s.length>0&&a((e=>[...e,...s]))},className:"file-input"}),(0,c.jsx)("button",{onClick:async()=>{if(!o)return void alert("Por favor, seleccione un tipo de estudio.");if(0===e.length)return void alert("No hay archivos seleccionados para subir.");const i=new FormData;e.forEach((e=>{let{file:a}=e;i.append("files",a)}));const n=localStorage.getItem("userID"),r=Math.floor(1e10*Math.random()).toString().padStart(10,"0");i.append("estudioID",r),i.append("tipoEstudio",o),i.append("donador",n);try{x(!0),f("Por favor espera, se est\xe1n cargando tus archivos, este proceso podr\xeda tardar un poco...");const e=await fetch(`${t.C}/donacion`,{method:"POST",body:i,headers:{Accept:"application/json"}});if(e.ok)alert("Archivos subidos exitosamente."),a([]),s("");else{const a=await e.text();p(`Error al subir archivos: ${a}`)}}catch(h){p(`Error de red: ${h.message}`)}finally{x(!1),f("")}},className:"upload-button",disabled:u||!o||0===e.length,children:u?"Subiendo...":"Subir Archivos"}),(0,c.jsx)("div",{class:"text-center",children:(0,c.jsxs)("p",{children:["Al subir tus archivos aceptas que has le\xeddo nuestro",(0,c.jsx)("a",{href:"/documentos/AVISO_PRIVACIDAD.pdf",target:"_blank",rel:"noopener noreferrer","aria-label":"T\xe9rminos y Condiciones",children:"Aviso de Privacidad"}),"y has aceptado nuestros",(0,c.jsx)("a",{href:"/documentos/TERMINOS_CONDICIONES.pdf",target:"_blank",rel:"noopener noreferrer","aria-label":"Aviso de Privacidad",children:"T\xe9rminos y Condiciones"}),"."]})}),m&&(0,c.jsx)("p",{className:"loading-message",children:m})," ",h&&(0,c.jsx)("p",{className:"error-message",children:h}),u&&(0,c.jsx)("div",{className:"loading-spinner",children:(0,c.jsx)("div",{className:"spinner"})})]}),(0,c.jsx)("div",{className:"donaciones-right",children:e.length>0?(0,c.jsxs)("table",{children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Nombre del archivo"}),(0,c.jsx)("th",{children:"Edad"}),(0,c.jsx)("th",{children:"Sexo"}),(0,c.jsx)("th",{children:"Regi\xf3n del cuerpo"}),(0,c.jsx)("th",{children:"Fecha de toma"}),(0,c.jsx)("th",{children:"Fecha de carga"}),(0,c.jsx)("th",{children:"Tipo de estudio"})]})}),(0,c.jsx)("tbody",{children:e.map(((e,a)=>{let{file:i,metadata:s}=e;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:i.name}),(0,c.jsx)("td",{children:s.age||"No disponible"}),(0,c.jsx)("td",{children:s.sex||"No disponible"}),(0,c.jsx)("td",{children:s.region||"No disponible"}),(0,c.jsx)("td",{children:s.date||"No disponible"}),(0,c.jsx)("td",{children:(new Date).toLocaleString()}),(0,c.jsx)("td",{children:o})]},a)}))})]}):(0,c.jsx)("p",{children:"No hay archivos seleccionados."})}),(0,c.jsx)("div",{className:"next-module"}),(0,c.jsx)(l.A,{})]})}},6559:()=>{}}]);
//# sourceMappingURL=555.42eae76c.chunk.js.map